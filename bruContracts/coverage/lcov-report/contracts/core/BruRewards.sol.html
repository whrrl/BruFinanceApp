<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/core/BruRewards.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">all files</a> / <a href="index.html">contracts/core/</a> BruRewards.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>64/64</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">91.67% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>22/24</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>13/13</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>66/66</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">56×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">//SPDX-License-Identifier: UNLICENSED
pragma solidity 0.8.7;
&nbsp;
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
import "@openzeppelin/contracts/proxy/utils/UUPSUpgradeable.sol";
import "@openzeppelin/contracts/proxy/utils/Initializable.sol";
import "./BruPool.sol";
import "./BruFactory.sol";
import "./BruOracle.sol";
import "../vesting/TokenVestingBru.sol";
&nbsp;
/**
 * @title BruRewards contract
 * @author Bru-finance team
 * @dev This contract is used to contains rewards logic
 */
contract BruRewards is Initializable, UUPSUpgradeable {
    using SafeERC20 for IERC20;
    uint256 public emission; // number of tokens emitted per interval
    uint256 internal secondsPerYear; // seconds in a year
&nbsp;
    address internal adminAddress; // address of Multisig wallet
    address internal factoryAddress; // address of BruFactory contract
    address internal bruToken; // address of Bru token
    address internal bruOracleAddress; // address of BruOracle contract
    address internal tokenVestingAddress; // address of TokenVestingBru contract
    //struct which is used to store reward details per interval
    struct RewardDetails {
        uint256 rewardTokens;
        uint256 startTime;
        uint256 endTime;
        uint256 totalLendAmount;
        uint256 totalBorrowedAmount;
        bool isActive;
    }
    // struct which is used to store the balance of user per interval
    struct UserBalance {
        uint256 lendAmount;
        uint256 borrowedAmount;
    }
&nbsp;
    mapping(uint256 =&gt; uint256) internal rewardIntervalIds; // used to store reward interval id for pool
    mapping(uint256 =&gt; mapping(uint256 =&gt; RewardDetails)) internal rewardDetails; //used to store reward details for pool
    mapping(uint256 =&gt; mapping(uint256 =&gt; mapping(address =&gt; UserBalance))) internal userBalance; // used to store user balance
    mapping(uint256 =&gt; mapping(uint256 =&gt; mapping(address =&gt; bool))) internal userClaims; // to check if the reward is claimed by user for an interval
    /**
     * @notice emitted during emission change action in the contract
     * @param _emission the new emission value in the contract
     */
    event EmissionChanged(uint256 _emission);
    /**
     * @notice emitted during reward interval started
     * @param _poolIndex the pool index for which the reward interval is started
     * @param _rewardAPY The number of reward APY
     */
    event PoolRewardsStarted(uint256 _poolIndex, uint256 _rewardAPY);
    /**
     * @notice emitted when pool reward stopped
     * @param _poolIndex the pool index for which the reward interval is stopped
     */
    event PoolRewardsStopped(uint256 _poolIndex);
    /**
     * @notice emitted when user lent amount updated during reward interval
     * @param _poolIndex The pool index for which the amount added
     * @param _userAddress The user address for which the lend amount updated
     * @param _amount The amount of tokens deposited during a reward interval
     */
    event LendAmountUpdated(uint256 _poolIndex, address _userAddress, uint256 _amount);
    /**
     * @notice emitted when user borrow amount updated during reward interval
     * @param _poolIndex The pool index for which the amount updated
     * @param _userAddress The user address for which the borrow amount updated
     * @param _amount The amount of tokens borrowed during a reward interval
     */
    event BorrowAmountUpdated(uint256 _poolIndex, address _userAddress, uint256 _amount);
&nbsp;
    /**
     * @notice emitted when user claims reward tokens for a particulat interval of a pool
     * @param _rewardIntervalId The pool index for which the amount updated
     * @param _poolIndex The user address for which the borrow amount updated
     * @param _userAddress The amount of tokens borrowed during a reward interval
     */
    event RewardsClaimed(uint256 _rewardIntervalId, uint256 _poolIndex, address _userAddress);
    /**
     * @dev Only admin can call functions marked by this modifier.
     */
    modifier onlyAdmin() {
        require(msg.sender == adminAddress, "Can be used only by admin");
        _;
    }
&nbsp;
    /**
     * @dev Only pool can call functions marked by this modifier.
     */
    modifier onlyPool(uint256 _poolIndex) {
        PoolDetails memory poolDetails = BruFactory(factoryAddress).getPoolDetails(_poolIndex);
        require(poolDetails.proxyPoolAddress == msg.sender, "Only pools can access");
        _;
    }
&nbsp;
    /**
     * @notice Initializes necessary contract addresses
     * @param _adminAddress The address of multisig wallet
     * @param _factoryAddress The address of factory contract
     * @param _bruToken address of bru token
     * @param _tokenVestingAddress The address of token vesting contract
     * @param _bruOracleAddress The address of bru oracle contract
     */
    function initialize(
        address _adminAddress,
        address _factoryAddress,
        address _bruToken,
        address _tokenVestingAddress,
        address _bruOracleAddress
    ) external virtual initializer {
        require(
            _adminAddress != address(0) &amp;&amp;
                _factoryAddress != address(0) &amp;&amp;
                _bruToken != address(0) &amp;&amp;
                _tokenVestingAddress != address(0) &amp;&amp;
                _bruOracleAddress != address(0),
            "Invalid Address"
        );
        adminAddress = _adminAddress;
        factoryAddress = _factoryAddress;
        bruToken = _bruToken;
        tokenVestingAddress = _tokenVestingAddress;
        bruOracleAddress = _bruOracleAddress;
        emission = 1000000000000000000000;
        secondsPerYear = 31536000;
    }
&nbsp;
    /**
     * @notice gets latest reward interval for a pool index
     * @param _poolIndex the pool index for which the status of the reward interval is to checked
     */
    function getLatestRewardIntervalForPool(uint256 _poolIndex) public view virtual returns (RewardDetails memory) {
        return rewardDetails[_poolIndex][rewardIntervalIds[_poolIndex]];
    }
&nbsp;
    /**
     * @notice used to calculate rewardAPY which is used while rewards distribution
     */
    function getRewardAPY() public view virtual returns (uint256) {
        uint256 tokenPrice = BruOracle(bruOracleAddress).getBruTokenPrice();
        uint256 numerator = emission * tokenPrice * secondsPerYear;
        uint256 tokenSupply = Token(BruFactory(factoryAddress).bruTokenAddress()).initialTokenSupply();
        uint256 denominator = tokenSupply * 1440 * 10;
        uint256 rewardAPY = numerator / denominator;
        return rewardAPY;
    }
&nbsp;
    /**
     * @notice used to changes the amount of emitted tokens during reward interval
     * @param _emission the new emission value in the contract
     */
    function changeEmission(uint256 _emission) external virtual onlyAdmin {
        emission = _emission;
        emit EmissionChanged(emission);
    }
&nbsp;
    /**
     * @notice starts rewards interval for pool
     * @param _poolIndex the pool index for which the reward interval is to be started
     * @param _durationInDays The duration for which the reward interval will be active
     */
    function startRewardsForPool(uint256 _poolIndex, uint256 _durationInDays) external virtual onlyAdmin {
        require(!rewardDetails[_poolIndex][rewardIntervalIds[_poolIndex]].isActive, "An interval is already active");
        rewardIntervalIds[_poolIndex] += 1;
        uint256 startTime = block.timestamp;
        uint256 endTime = startTime + _durationInDays * 86400;
        PoolDetails[] memory allPoolDetails = BruFactory(factoryAddress).getAllPoolDetails();
        uint256 poolTokenAmount = emission / allPoolDetails.length;
        rewardDetails[_poolIndex][rewardIntervalIds[_poolIndex]] = RewardDetails(
            poolTokenAmount,
            block.timestamp,
            endTime,
            0,
            0,
            true
        );
        PoolDetails memory poolDetails = BruFactory(factoryAddress).getPoolDetails(_poolIndex);
        uint256 rewardAPY = getRewardAPY();
        BruPool(poolDetails.proxyPoolAddress).startRewards(rewardAPY);
        TokenVestingBru(tokenVestingAddress).distributeRewards(emission);
        emit PoolRewardsStarted(_poolIndex, rewardAPY);
    }
&nbsp;
    /**
     * @notice stops rewards interval for pool
     * @param _poolIndex the pool index for which the reward interval is to be stopped
     */
    function stopRewardsForPool(uint256 _poolIndex) external virtual onlyAdmin {
        require(rewardDetails[_poolIndex][rewardIntervalIds[_poolIndex]].isActive, "rewards should be active");
        require(
            block.timestamp &gt; rewardDetails[_poolIndex][rewardIntervalIds[_poolIndex]].endTime,
            "Rewards duration not completed"
        );
        rewardDetails[_poolIndex][rewardIntervalIds[_poolIndex]].isActive = false;
        PoolDetails memory poolDetails = BruFactory(factoryAddress).getPoolDetails(_poolIndex);
        BruPool(poolDetails.proxyPoolAddress).stopRewards();
        emit PoolRewardsStopped(_poolIndex);
    }
&nbsp;
    /**
     * @notice checks if reward interval is active for a pool index
     * @param _poolIndex the pool index for which the status of the reward interval is to checked
     */
    function getRewardStatusForPool(uint256 _poolIndex) external view virtual returns (bool) {
        return
            rewardDetails[_poolIndex][rewardIntervalIds[_poolIndex]].isActive &amp;&amp;
            (rewardDetails[_poolIndex][rewardIntervalIds[_poolIndex]].endTime &gt;= block.timestamp);
    }
&nbsp;
    /**
     * @notice updates user's lent amount when a reward interval is active for a particular pool
     * @param _poolIndex the pool index for which the amount is to be added
     * @param _userAddress The user address for which the lend amount is to be updated
     * @param _amount The amount of tokens deposited during a reward interval
     */
    function updateLendAmountInRewardsInterval(
        uint256 _poolIndex,
        address _userAddress,
        uint256 _amount
    ) external virtual onlyPool(_poolIndex) {
        uint256 id = rewardIntervalIds[_poolIndex];
        userBalance[_poolIndex][id][_userAddress].lendAmount += _amount;
        rewardDetails[_poolIndex][rewardIntervalIds[_poolIndex]].totalLendAmount += _amount;
        emit LendAmountUpdated(_poolIndex, _userAddress, _amount);
    }
&nbsp;
    /**
     * @notice updates user's borrowed amount when a reward interval is active for a particular pool
     * @param _poolIndex the pool index for which the amount is to be added
     * @param _userAddress The user address for which the borrowed amount is to be updated
     * @param _amount The amount of tokens borrowed by user during a reward interval
     */
    function updateBorrowAmountInRewardsInterval(
        uint256 _poolIndex,
        address _userAddress,
        uint256 _amount
    ) external virtual onlyPool(_poolIndex) {
        uint256 id = rewardIntervalIds[_poolIndex];
        userBalance[_poolIndex][id][_userAddress].borrowedAmount += _amount;
        rewardDetails[_poolIndex][rewardIntervalIds[_poolIndex]].totalBorrowedAmount += _amount;
        emit BorrowAmountUpdated(_poolIndex, _userAddress, _amount);
    }
&nbsp;
    /**
     * @notice It is used by users to claim their reward bru tokens from the reward contracts.
     * @param _poolIndex the pool index for which the users want to claim tokens
     * @param _rewardIntervalId The reward interval from which the users want to claim tokens.
     */
&nbsp;
    function claimRewards(uint256 _poolIndex, uint256 _rewardIntervalId) external virtual {
        require(rewardDetails[_poolIndex][_rewardIntervalId].startTime &gt; 0, "Rewards interval does not exist");
&nbsp;
        require(!userClaims[_poolIndex][_rewardIntervalId][msg.sender], "Rewards has already been claimed");
        RewardDetails memory rewardDetailsForPool = rewardDetails[_poolIndex][_rewardIntervalId];
&nbsp;
        require(
            block.timestamp &gt; rewardDetails[_poolIndex][_rewardIntervalId].endTime,
            "Rewards duration not completed"
        );
        uint256 bruTokenAmountForLend;
        uint256 bruTokenAmountForBorrow;
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>if (rewardDetailsForPool.totalLendAmount &gt; 0) {
            uint256 userPercentageInLend = ((userBalance[_poolIndex][_rewardIntervalId][msg.sender].lendAmount) *
                10**18) / (rewardDetailsForPool.totalLendAmount);
&nbsp;
            bruTokenAmountForLend = (userPercentageInLend * (rewardDetailsForPool.rewardTokens / 2)) / 10**18;
        }
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>if (rewardDetailsForPool.totalBorrowedAmount &gt; 0) {
            uint256 userPercentageInBorrow = (userBalance[_poolIndex][_rewardIntervalId][msg.sender].borrowedAmount *
                10**18) / (rewardDetailsForPool.totalBorrowedAmount);
            bruTokenAmountForBorrow = (userPercentageInBorrow * (rewardDetailsForPool.rewardTokens / 2)) / 10**18;
        }
&nbsp;
        uint256 totalAmount = bruTokenAmountForBorrow + bruTokenAmountForLend;
&nbsp;
        userClaims[_poolIndex][_rewardIntervalId][msg.sender] = true;
        IERC20(bruToken).safeTransfer(msg.sender, totalAmount);
        emit RewardsClaimed(_rewardIntervalId, _poolIndex, msg.sender);
    }
&nbsp;
    /**
     * @dev Checks the wallet address which initiates the upgrade transaction for BruRewards contract
     * @param _newImplementation Address of the new implementation contract which is used for upgradation.
     */
    function _authorizeUpgrade(address _newImplementation) internal view override {
        require(msg.sender == adminAddress, "Only admin allowed");
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed May 31 2023 10:39:20 GMT+0530 (India Standard Time)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
